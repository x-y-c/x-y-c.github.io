---
layout: post
title: 'nginx图片服务器以及jsoup处理html'
date: 2019-08-02
tags: 后端  nginx
---

# 问题及分析

在前端使用vue框架的v-html标签进行渲染的时候，`<img>`中的图片不能正常显示，通过测试，发现使用 以`http://`开头的绝对路径可以正常显示，所以，解决的方案为 将本地图片转为以http为开头的绝对路径。

## 那么······，如何让图片的路径为 http开头呢? 需要一个 图片服务器

### 好，在确定了原因以后，那么问题来了，如何搭建一个图片服务器？

1、通过查询资料，发现nginx可以作为图片服务器。

####  下面就正式开始了

1、首先，服务器的操作系统是 ubuntu 16.04，通过 `sudo apt-get install nginx` 就可以安装稳定版的nginx的服务器啦

2、在安装完nginx后，需要在配置文件中添加对应的信息。ubuntu系统中，nginx.conf 的位置在 `/etc/nginx/nginx.conf`，打开这个文件，在http中新建一个server，在server中填写图片服务器的相关配置，

```
 
 {
 listen     2048;
   server_name localhost;
        location /ckupload/{
                alias /root/TestCase_picture/ckupload/;
                autoindex on;
		}
	}

listen 表示最终的图片服务器的端口，
server_name 表示配置的虚拟主机，这里因为就用本机，所以写localhost 就ok啦。
location 表示访问的路径，
这里其实有两种配置方式：
root响应的路径：配置的路径（root指向的路径）+完整访问路径(location的路径）+静态文件
alias响应的路径：配置路径+静态文件(去除location中配置的路径)，
也就是说： 如果用root ，则对应的实际图片路径为 /root/TestCase_picture/ckupload/chupload,显然路径是错误的，所以，在配置过程中，选用了 alias ，则实际路径为 /root/TestCase_picture/ckupload 

```



这样就配置好了，需要注意的是，在完成配置之后，还要给 文件夹 读写权限。

最后，在nginx.conf的配置文件的第一行中，添加 user root，否则可能会访问403错误

#### jsoup

*jsoup是一款Java的HTML解析器，主要用来对HTML解析*

所以，通过jsoup就可以解决问题啦！！！！！！！1

         #### jsoup 处理html中img路径问题

```java
public static String setImagesDomain(String htmlStr){ 
    Document doc = Jsoup.parse(htmlStr); 
    Elements srcs = doc.select("img[src]"); 
    String domainStr="http://localhost:2048"; 
    for (Element element : srcs) { 
String imgUrl = element.attr("src"); 
if (imgUrl.trim().startsWith("/")) { 
imgUrl =domainStr + imgUrl; 
element.attr("src", imgUrl); 
} 
} 
    return doc.toString(); 
    }
```

这样，img路径问题也解决了。

